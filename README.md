# API v3 Client

## Overview

This package's goal is to make it easier to call:
[EuropeanSourcing's Product API](https://product-api.europeansourcing.com/public/index.html) in a PHP project.

## Setup

To install and update this package we recommend to use [Composer](https://getcomposer.org/)

```shell
composer require european-sourcing/apiv3-client
```

## Prerequisites 

Since this package isn't directly available on the official Packagist repository, but only on this Github repository,
you need to have a free Github account to be able to access this package with Composer.

Then, you will have to add this repository to your file `composer.json` by adding a `repositories` property like
shown below:

```
{
    "name": "my-company/my-project",
    "version": "0.0.1",
    "type": "project",
    "require": {
        "european-sourcing/apiv3-client": "^4.0.0"
    },
    "repositories": [
        {
            "type": "vcs",
            "url": "git@github.com:european-sourcing/api-v3-client.git"
        }
    ]
}
```

## Implementation examples

Example of an `index.php` at the root of the project (same as the composer.json file)

```php
<?php

// Include the autoload generated by Composer
require_once __DIR__ . '/vendor/autoload.php';

use GuzzleHttp\Client as GuzzleClient;
use EuropeanSourcing\Apiv3Client\Client;
use EuropeanSourcing\Apiv3Client\QueryBuilder;
use EuropeanSourcing\Apiv3Client\QueryHandler;
use EuropeanSourcing\Apiv3Client\SearchHandler;

$YOUR_API_TOKEN = 'YOUR_API_TOKEN';

$guzzleClient = new GuzzleClient([
    'headers' => [
        'Content-Type' => 'application/json',
    ]
]);

$apiClient = new Client(
    $guzzleClient,
    'https://product-api.europeansourcing.com/api/v1.1',
    $YOUR_API_TOKEN
);


/**
 * Get all supplier profiles
 */
try {
    $suppliers = $apiClient->supplierProfiles();
} catch (\Exception $e) {
    // error handling
    echo "Une erreur c'est produite lors de la récupération des fournisseurs: " . $e->getMessage();
    throw $e;
}

foreach ($suppliers as $supplier) {
    echo "Profil fournisseur ID " . $supplier->getId() . " - " . $supplier->getName() . "<br/>";
}


echo "<hr/>";


/**
 * Get every brands
 */
try {
    $brands = $apiClient->brands();
} catch (\Exception $e) {
    // error handling
    echo "Une erreur c'est produite lors de la récupération des marques: " . $e->getMessage();
    throw $e;
}

foreach ($brands as $brand) {
    echo "Marque ID " . $brand->getId() . " - " . $brand->getName() . "<br/>";
}


echo "<hr/>";


/**
 * Product research
 */
$searchHandler = new SearchHandler();

$queryBuilder = new QueryBuilder();
$searchHandler->add(
    $queryBuilder->query('mug')
);
$searchHandler->add(
    $queryBuilder->supplierProfile([166])
);

$locale = 'fr';
$queryHandler = new QueryHandler($locale);
$queryHandler->addSearchHandler($searchHandler);
$queryHandler->setPage(1);
$queryHandler->setPerpage(50);
$queryHandler->setSortField('price');
$queryHandler->setSortDirection('asc');

try {
    $response = $apiClient->search($queryHandler);
} catch (\Exception $e) {
    // error handling
    echo "Une erreur c'est produite lors de la récupération des produits: " . $e->getMessage();
    throw $e;
}

$products = $response->getProducts();

echo "Nombre total de produits pour cette recherche: " . $response->getTotalProducts() . "<br/>";
echo "Nombre de produits pour cette page: " . count($products) . "<br/>";

foreach ($products as $product) {
    echo "Produit ID " . $product->getId() . " - " . $product->getBestVariant()->getName() . "<br/>";
}
?>
```
