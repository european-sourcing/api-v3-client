# API v3 Client

## Présentation

Ce package permet de faciliter la mise en place d'appels à
l'[API Produit d'European Sourcing](https://product-api.europeansourcing.com/public/index.html) dans un projet PHP.

## Installation

Pour installer et mettre à jour ce package, nous vous recommandons d'utiliser [Composer](https://getcomposer.org/)

```shell
composer require medialeads/apiv3-client
```

## Pré-requis

Comme ce package n'est pas directement disponible sur le dépôt officiel Packagist, mais uniquement sur ce dépôt Github,
vous devez posséder un compte Github (gratuit) pour pouvoir récupérer ce package avec Composer.

Ensuite, vous devrez ajouter ce dépôt à votre fichier `composer.json` via une entrée `repositories` comme ci-dessous:

```
{
    "name": "my-company/my-project",
    "version": "0.0.1",
    "type": "project",
    "require": {
        "medialeads/apiv3-client": "^2.1.0"
    },
    "repositories": [
        {
            "type": "vcs",
            "url": "git@github.com:european-sourcing/api-v3-client.git"
        }
    ]
}
```

## Exemples d'implémentations

Example d'un `index.php` à la racine du projet (au même niveau que le composer.json)

```php
<?php

// Include the autoload generated by Composer
require_once __DIR__ . '/vendor/autoload.php';

use GuzzleHttp\Client as GuzzleClient;
use Medialeads\Apiv3Client\Client;
use Medialeads\Apiv3Client\QueryBuilder;
use Medialeads\Apiv3Client\QueryHandler;
use Medialeads\Apiv3Client\SearchHandler;

$YOUR_API_TOKEN = 'YOUR_API_TOKEN';

$guzzleClient = new GuzzleClient([
    'headers' => [
        'Content-Type' => 'application/json',
    ]
]);

$apiClient = new Client(
    $guzzleClient,
    'https://product-api.europeansourcing.com/api/v1.1',
    $YOUR_API_TOKEN
);


/**
 * Récupération de tous les profils fournisseurs
 */
try {
    $suppliers = $apiClient->supplierProfiles();
} catch (\Exception $e) {
    // Gestion des erreurs
    echo "Une erreur c'est produite lors de la récupération des fournisseurs: " . $e->getMessage();
    throw $e;
}

foreach ($suppliers as $supplier) {
    echo "Profil fournisseur ID " . $supplier->getId() . " - " . $supplier->getName() . "<br/>";
}


echo "<hr/>";


/**
 * Récupération de toutes les marques
 */
try {
    $brands = $apiClient->brands();
} catch (\Exception $e) {
    // Gestion des erreurs
    echo "Une erreur c'est produite lors de la récupération des marques: " . $e->getMessage();
    throw $e;
}

foreach ($brands as $brand) {
    echo "Marque ID " . $brand->getId() . " - " . $brand->getName() . "<br/>";
}


echo "<hr/>";


/**
 * Recherche de produits
 */
$searchHandler = new SearchHandler();

$queryBuilder = new QueryBuilder();
$searchHandler->add(
    $queryBuilder->query('mug')
);
$searchHandler->add(
    $queryBuilder->supplierProfile([166])
);

$locale = 'fr';
$queryHandler = new QueryHandler($locale);
$queryHandler->addSearchHandler($searchHandler);
$queryHandler->setPage(1);
$queryHandler->setPerpage(50);
$queryHandler->setSortField('price');
$queryHandler->setSortDirection('asc');

try {
    $response = $apiClient->search($queryHandler);
} catch (\Exception $e) {
    // Gestion des erreurs
    echo "Une erreur c'est produite lors de la récupération des produits: " . $e->getMessage();
    throw $e;
}

$products = $response->getProducts();

echo "Nombre total de produits pour cette recherche: " . $response->getTotalProducts() . "<br/>";
echo "Nombre de produits pour cette page: " . count($products) . "<br/>";

foreach ($products as $product) {
    echo "Produit ID " . $product->getId() . " - " . $product->getBestVariant()->getName() . "<br/>";
}
?>
```
